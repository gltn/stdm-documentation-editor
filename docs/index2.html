<!DOCTYPE html>
<html lang="en">

<head>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


    <!-- Bootstrap Core CSS -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/js/tipue_search_6_0/css/tipuesearch.css">
    <!-- Custom CSS -->
    <link href="assets/css/custom.css" rel="stylesheet">
    <link rel="stylesheet"
          href="assets/js/jstree_a6a0d0d/themes/default/style.css"/>
<script src="assets/js/jquery.js " type="text/javascript"></script>
    <script src="current_file.js"></script>
    <script src="languages_with_content.js"></script>

        <script type="text/javascript" src="assets/js/tipue_search_6_0/tipuesearch_set.js"></script>
<script type="text/javascript" src="assets/js/tipue_search_6_0/tipuesearch_content.js"></script>
<link rel="stylesheet" type="text/css" href="assets/js/tipue_search_6_0/css/tipuesearch.css">
<script type="text/javascript" src="assets/js/tipue_search_6_0/tipuesearch.min.js"></script>

    <script>
    var toc_src, doc_list_src, language, current_name, doc_src,
        current_js_path, local_store, doc_path, curr_data;
//        localStorage.clear();
        if (localStorage["curr_data"] === undefined) {
            console.log(localStorage.length);
            curr_data = {
                'current_js_path': html_file.current_js_path,
                'current_name': html_file.current_name,
                'doc_path': html_file.doc_path,
                'language': html_file.language,
                'search_data': html_file.search_data
            };
            // Put the object into storage
            retrieved_object = localStorage.getItem(
                'curr_data', JSON.stringify(curr_data)
            );
            // Retrieve the object from storage
            local_store = JSON.parse(retrieved_object);
            toc_src = html_file.doc_path + '/table_of_contents.js';
            doc_list_src = html_file.doc_path + '/docs_js_list.js';
            language = html_file.language;
            current_name = html_file.current_name;
            doc_src = html_file.current_js_path;
            current_js_path = html_file.current_js_path;
            doc_path = html_file.doc_path;
            search_data = html_file.search_data;
            console.log(doc_path, toc_src);
        }
        else {
            local_store = JSON.parse(localStorage["curr_data"]);
            toc_src = local_store.doc_path + '/table_of_contents.js';
            console.log(toc_src);
            doc_list_src = local_store.doc_path + '/docs_js_list.js';
            language = local_store.language;
            current_name = local_store.current_name;
            current_js_path = local_store.current_js_path;
            doc_path = local_store.doc_path;
            search_data = local_store.search_data;
            console.log(doc_path);
        }
        console.log(doc_path);
        document.write('<' + 'script src="' +
            doc_list_src + '" type="text/javascript"><' + '/script' + '>');
        document.write('<' + 'script src="' + toc_src +
            '" type="text/javascript"><' + '/script' + '>');
        console.log(current_js_path);
        document.write('<' + 'script src="' + current_js_path +
            '" type="text/javascript"><' + '/script' + '>');

    </script>

    <style>

    </style>
</head>

<body>

<!----<p>Click <a href="index.html#preview">here</a>.</p>-->

<!-- Navigation -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://stdm.gltn.net"><img
                    src="images/logo.png"></a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse"
             id="bs-example-navbar-collapse-1">
            STDM 1.5 User Manual
            <!--<ul class="nav navbar-nav">-->
            <!--<li>-->
            <!--<a href="#">Installing STDM</a>-->
            <!--</li>-->

            <!--<li>-->
            <!--<a href="#">About</a>-->
            <!--</li>-->
            <!--</ul>-->
            <div class="nav navbar-nav navbar-right">

                <select class="form-control" id="stdm_version"
                        data-width="fit">
                    <option value="1_5">STDM 1.5</option>
                </select>

                <select class="form-control" id="added_languages"
                        data-width="fit">

                </select>
            </div>

        </div>
        <!-- /.navbar-collapse -->

    </div>
    <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">

    <div class="row">

        <div class="col-md-3">
            <p class="lead">Table of Contents</p>
            <form action="index2.html">
<div class="tipue_search_left"><img src="images/search.png" class="tipue_search_icon"></div>
<div class="tipue_search_right"><input type="text" name="q" id="tipue_search_input" pattern=".{3,}" title="At least 3 characters" required></div>
<div style="clear: both;"></div>
</form>
            <!--<label>Search<input type="text" id="search_toc"></label>-->
            <div class="list-group" id="st_side_menu">


            </div>
        </div>

        <div class="col-md-9" id="doc_container">
<div id="tipue_search_content" style="display: block;">

</div>


        </div>

    </div>

</div>
<!-- container -->

<div class="container">

    <hr>

    <!-- Footer -->
    <footer>
        <div class="row">
            <div class="col-lg-12">
                <p>Copyright &copy; UN Habitat</p>
            </div>
            <a id="refresh">Refresh</a>
        </div>
    </footer>

</div>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/jstree_a6a0d0d/jstree.js"></script>

<script>

    function insert_js_docs() {
        for (var j = 0; j < js_doc_files.length; j++) {
            var doc_script = document.createElement('script');
            doc_script.setAttribute('src', js_doc_files[j]);
            document.head.appendChild(doc_script);
        }
    }
    insert_js_docs();

    function setup_side_menu() {
        $('#st_side_menu').html(window['toc_' + language][0]);
        $('#doc_container').html(window[current_name][0]);
        $('#st_side_menu').on('loaded.jstree', treeLoaded).jstree({

            "plugins": [
                "contextmenu",
                "massload",
                "search",
                "types",
                "changed"
            ],
             "search": {

            "case_insensitive": false,
            "show_only_matches" : true
        },
            "types": {
                "default": {
                    "icon": "glyphicon glyphicon-folder-open"
                }
            }

        }).on('changed.jstree', function (NODE, REF_NODE) {
            var clicked_file = REF_NODE.node.a_attr.href;
            if (clicked_file.length < 5) {
                return
            }
            var doc_name = clicked_file.split('.')[0].replace(/-/g, '_');
            $('#doc_container').html(window[doc_name]);
        });

        function treeLoaded(event, data) {
            var prev_node = $('#st_side_menu').find(current_name);
            var prev_parent = $('#st_side_menu').jstree("get_parent", prev_node);
//   console.log($('#st_side_menu').find(local_store.current_name));
            $("#st_side_menu").jstree("select_node", prev_node);
            $("#st_side_menu").jstree("select_node", prev_parent);
            $("#st_side_menu").jstree("open_node", prev_parent);
        }
            // bind customize icon change function in jsTree open_node event.
            $('#st_side_menu').on('open_node.jstree', function (e, data) {
                var icon = $('#' + data.node.id).find(
                    'i.jstree-icon.jstree-themeicon').first();
                icon.removeClass('glyphicon glyphicon-folder-close').addClass(
                    'glyphicon glyphicon-folder-open');
            });
            // bind customize icon change function in jsTree open_node event.
            $('#st_side_menu').on('select_node.jstree', function (e, data) {
                if (data.node.a_attr.href != '') {
                    window.location.hash = data.node.a_attr.href
                }
                else {
                    window.location.hash = 'no_page';
                }

            });
            // bind customize icon change function in jsTree close_node event.
            $('#st_side_menu').on('close_node.jstree', function (e, data) {
                var icon = $(
                    '#' + data.node.id).find(
                    'i.jstree-icon.jstree-themeicon').first();
                icon.removeClass(
                    'glyphicon glyphicon-folder-open').addClass(
                    'glyphicon glyphicon-folder-close');
            });
        }

        $(document).ready(function () {
            setup_side_menu();

        });

        // load languages list
        var option;
        for (var key in added_languages) {
            if (added_languages.hasOwnProperty(key)) {
                option += '<option value="' + key + '">' +
                    added_languages[key] + '</option>';
            }
        }
        $('#added_languages').append(option);
        $( "#added_languages option[value='" + language + "']").prop(
            'selected', true
        );

        // handle language changes
        $('#added_languages').on('change', function () {
            // Set local storage before close.
            var sel_node = $("#st_side_menu").jstree("get_selected");
            if (sel_node.length < 1) {
                sel_html = current_js_path;
            }
            else {
                var sel_html = $('#' + sel_node).find('a').first()[0].href;
            }
            var curr_name = sel_html.split('/').reverse()[0].split('.')[0];
            var version = doc_path.split('/')[0];
            var curr_doc_path = version + '/' + this.value;
            var curr_js_path = curr_doc_path + '/' + curr_name + '.js';

            curr_data = {
                'current_js_path': curr_js_path,
                'current_name': curr_name,
                'doc_path': curr_doc_path,
                'language': this.value
            };
            // Put the object into storage
            localStorage.setItem(
                'curr_data', JSON.stringify(curr_data)
            );
            // reload the page to load with the new language content
            location.reload();
        });
        $(document).ready(function() {
             $('#tipue_search_input').tipuesearch({
                 'newWindow': false
             });
//          $('#refresh').on("click",function(){
//              localStorage.clear();
//              location.reload();
//          });
});
</script>
</body>

</html>

